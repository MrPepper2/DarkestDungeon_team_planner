<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Darkest Dungeon Team Planner</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #222;
      color: white;
    }

    h1 {
      text-align: center;
      color: #ff6347;
    }

    .menu-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-top: 30px;
    }

    .menu {
      background-color: #444;
      padding: 20px;
      border-radius: 8px;
      width: 250px;
      text-align: center;
      margin-bottom: 20px;
    }

    .menu h2 {
      color: #ff6347;
    }

    .menu select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 5px;
    }

    .gif-box {
      width: 250px;
      height: 420px;
      margin-top: 15px;
      display: flex;
      justify-content: center;
      align-items: flex-end;
      background-color: #333;
      margin-left: auto;
      margin-right: auto;
    }

    .hero-gif {
      max-width: 100%;
      max-height: 100%;
    }

    .ability-container {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      justify-content: center;
      margin-top: 10px;
    }

    .ability-slot {
      width: 90px;
      height: 90px;
      background-color: #111;
      border: 2px solid #777;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      padding: 0;
      overflow: hidden;
    }

    .ability-slot img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .ability-menu {
      position: absolute;
      display: none;
      background: rgba(0, 0, 0, 0.9);
      padding: 10px;
      border-radius: 5px;
      width: auto;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 4px;
      justify-items: center;
      z-index: 9999;
      max-width: 400px;
      max-height: 500px;
      overflow: auto;
    }

    .ability-menu img {
      width: 90px;
      height: 90px;
      object-fit: cover;
    }
  </style>
</head>
<body>
  <h1>Darkest Dungeon Team Planner</h1>

  <div class="menu-container">
    <script>
      let ranks = ["rank4", "rank3", "rank2", "rank1"];
      let heroes = ["abomination", "antiquarian", "arbalest", "bounty_hunter", "crusader"];
      let abilityNames = ["one", "two", "three", "four", "five", "six", "seven"];

      // Dynamically generating the rank menus
      document.addEventListener("DOMContentLoaded", function() {
        for (let rank of ranks) {
          let menuHTML = `
            <div class="menu" id="${rank}">
              <h2>${rank.replace("rank", "Rank ")}</h2>
              <select id="${rank}-select" onchange="loadGif('${rank}'); updateAbilitySlots('${rank}')">
                <option value="none">None</option>
                ${heroes.map(hero => `<option value="${hero}">${hero.replace("_", " ")}</option>`).join('')}
              </select>
              <div class="gif-box">
                <img id="${rank}-gif" class="hero-gif" style="display:none;">
              </div>
              <p class="section-title"><u>Skills</u></p>
              <div class="ability-container" id="${rank}-abilities"></div>
            </div>
          `;

          document.querySelector(".menu-container").innerHTML += menuHTML;
        }
      });

      // Function to load the hero gif when selected
      function loadGif(rank) {
        var selectMenu = document.getElementById(rank + "-select");
        var selectedHero = selectMenu.value;
        var gifElement = document.getElementById(rank + "-gif");

        if (selectedHero !== "none") {
          var gifPath = `./heroes/${selectedHero}/${selectedHero}_A/${selectedHero}.gif`;
          gifElement.src = gifPath;
          gifElement.style.display = "block";
        } else {
          gifElement.style.display = "none";
        }
      }

      // Function to update the ability slots based on the selected hero
      function updateAbilitySlots(rank) {
        var selectedHero = document.getElementById(rank + "-select").value;
        var abilityContainer = document.getElementById(rank + "-abilities");
        abilityContainer.innerHTML = "";

        let slotCount = (selectedHero === "abomination") ? 7 : 4;

        for (let i = 0; i < slotCount; i++) {
          let slot = document.createElement("div");
          slot.classList.add("ability-slot");
          slot.onclick = function() { openAbilityMenu(rank, i); };
          abilityContainer.appendChild(slot);

          let abilityImg = document.createElement("img");
          abilityImg.src = `./heroes/${selectedHero}/${selectedHero}.ability.${abilityNames[i]}.png`;
          abilityImg.style.display = "block";
          slot.appendChild(abilityImg);
        }
      }

      // Function to open the ability menu for selecting a new ability
      function openAbilityMenu(rank, slotIndex) {
        var selectedHero = document.getElementById(rank + "-select").value;
        if (selectedHero === "none") return;

        var abilityMenu = document.getElementById("ability-menu");
        abilityMenu.innerHTML = "";

        for (let name of abilityNames) {
          let abilityImg = document.createElement("img");
          abilityImg.src = `./heroes/${selectedHero}/${selectedHero}.ability.${name}.png`;
          abilityImg.onclick = function() {
            selectAbility(rank, slotIndex, abilityImg.src);
          };
          abilityMenu.appendChild(abilityImg);
        }

        let slotElement = document.querySelectorAll(`#${rank} .ability-slot`)[slotIndex];
        let slotRect = slotElement.getBoundingClientRect();
        let menuLeft = slotRect.left + window.scrollX;
        let menuTop = slotRect.top + window.scrollY - 10;
        abilityMenu.style.left = menuLeft + "px";
        abilityMenu.style.top = menuTop + "px";
        abilityMenu.style.display = "grid";
      }

      // Function to select an ability and update the slot with the chosen ability
      function selectAbility(rank, slotIndex, abilitySrc) {
        let slot = document.querySelectorAll(`#${rank} .ability-slot`)[slotIndex];
        let abilityImg = slot.querySelector("img");

        if (!abilityImg) {
          abilityImg = document.createElement("img");
          slot.appendChild(abilityImg);
        }

        abilityImg.src = abilitySrc;
        abilityImg.style.display = "block";

        document.getElementById("ability-menu").style.display = "none";
      }

      // Close the ability menu if clicked outside
      document.addEventListener("click", function(event) {
        if (!event.target.closest(".ability-slot") &&
            !event.target.closest(".ability-menu")) {
          document.getElementById("ability-menu").style.display = "none";
        }
      });
    </script>
  </div>

  <div id="ability-menu" class="ability-menu"></div>

</body>
</html>
